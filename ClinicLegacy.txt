CREATE DATABASE clinic_db;

\c clinic_db

CREATE SCHEMA clinic_schema;

SET search_path = clinic_schema, public;

CREATE TABLE contingent (id_cont integer UNIQUE NOT NULL, name_cont varchar(40) NOT NULL);

CREATE TABLE reg_group (id_reg_group integer UNIQUE NOT NULL, name_reg_group varchar(20) NOT NULL);

CREATE TABLE speciality (id_spec integer GENERATED ALWAYS AS IDENTITY PRIMARY KEY, name_spec varchar(20) NOT NULL, type_spec boolean);

CREATE TABLE staff (id_staff integer GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
					fam_doctor varchar(15) NOT NULL,
					name_doctor varchar(15) NOT NULL,
					otch_doctor varchar(15) NOT NULL);

CREATE TABLE department (id_dep integer GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
					name_dep varchar(20) NOT NULL,
					type_dep boolean DEFAULT 'false',
					short_dep varchar(7) NOT NULL);
					
CREATE TABLE street (id_street integer GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
					type_street varchar(4) NOT NULL,
					name_street varchar(18) NOT NULL);
					
CREATE TABLE visit_type (id_visit_type integer PRIMARY KEY, name_visit_type varchar(20) NOT NULL);

CREATE TABLE period_list (id_period integer GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
					name_period varchar(64) NOT NULL,
					begin_period date NOT NULL,
					end_period date);

CREATE TABLE target_spo (id_target integer PRIMARY KEY,
					name_target varchar(64) NOT NULL);
					
CREATE TABLE zab_type (id_zab_type integer PRIMARY KEY,
					name_zab_type varchar(64) NOT NULL);
					
CREATE TABLE age_group (id_age_group integer GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
					from_age integer NOT NULL,
					to_age integer NOT NULL,
					name_age_group char(64));
					
CREATE TABLE hospital_list (id_hospital integer GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
					type_hospital varchar(20) NOT NULL);

CREATE TABLE doc_type_list (id_doc_type integer GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
					name_doc_type varchar(20) NOT NULL);



--2
CREATE TABLE mkb_class (id_mkb_int integer PRIMARY KEY,
				id_mkb_class varchar(5) NOT NULL,
				ds varchar(180) NOT NULL);

CREATE TABLE mkb (id_mkb varchar(3) PRIMARY KEY,
				ds varchar(180) NOT NULL,
				id_mkb_int integer REFERENCES mkb_class(id_mkb_int));
				
				
CREATE TABLE doctor (id_doctor integer GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
					id_staff integer REFERENCES staff (id_staff),
					id_dep integer REFERENCES department (id_dep),
					id_spec integer REFERENCES speciality (id_spec),
					empl_date date,
					dism_date date,
					state boolean);
					

CREATE TABLE area (id_area integer PRIMARY KEY,
					id_doctor integer REFERENCES doctor (id_doctor));
					
CREATE TABLE address (id_address integer GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
						id_area integer REFERENCES area (id_area),
						id_street integer REFERENCES street (id_street),
						num_dom integer NOT NULL,
						let_dom char(1),
						korp_dom char (4),
						str_dom char(4));

--3
CREATE TABLE amb_card (id_card integer GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
						fam_patient char(15),
						name_patient char(18),
						otch_patient char(15),
						b_date date,
						pol char(1),
						id_address integer REFERENCES address (id_address),
						num_kv integer,
						num_tel integer,
						id_cont integer REFERENCES contingent (id_cont),
						organization char(32),
						position char(24),
						ser_polis char(2),
						num_polis integer,
						id_reg_group integer REFERENCES reg_group (id_reg_group),
						create_date date);

CREATE TABLE talon (id_talon integer GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
					id_card integer REFERENCES amb_card (id_card),
					id_target integer REFERENCES target_spo (id_target),
					type_spo integer,
					spo integer,
					open_date date,
					close_date date);

--4

CREATE TABLE visit (id_visit integer GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
					id_talon integer REFERENCES talon (id_talon),
					visit_date date,
					id_visit_type integer REFERENCES visit_type (id_visit_type),
					id_zab_type integer REFERENCES zab_type (id_zab_type),
					id_doctor integer REFERENCES doctor (id_doctor),
					id_mkb char(3) REFERENCES mkb (id_mkb),
					next_date date
);

--5

CREATE TABLE diagnos (id_card integer PRIMARY KEY REFERENCES amb_card (id_card),
						id_mkb char(3) REFERENCES mkb (id_mkb),
						det_date date);


CREATE TABLE document (id_talon integer PRIMARY KEY REFERENCES talon (id_talon),
						id_doc_type integer,
						begin_doc date,
						close_doc date);

CREATE TABLE hospital (id_talon integer PRIMARY KEY REFERENCES talon (id_talon),
						id_hospital integer REFERENCES hospital_list (id_hospital),
						begin_hospital date,
						end_hospital date);


CREATE TABLE soput_ds (id_visit integer PRIMARY KEY REFERENCES visit (id_visit),
						id_zab_type integer REFERENCES zab_type (id_zab_type),
						id_mkb char(3) REFERENCES mkb (id_mkb));


CREATE TABLE report_spo (id_doctor integer REFERENCES doctor (id_doctor),
							id_target integer REFERENCES target_spo (id_target),
							id_period integer REFERENCES period_list (id_period),
							cnt_service integer,
							cnt_home integer,
							primary_z integer,
							primary_n integer,
							repeated_z integer,
							repeated_n integer,
							PRIMARY KEY (id_doctor, id_target, id_period)
);


CREATE TABLE report_zab (id_period integer REFERENCES period_list (id_period),
							id_age_group integer REFERENCES age_group (id_age_group),
							id_mkb char(3) REFERENCES mkb (id_mkb),
							pol_patient char(1),
							acute_zab integer,
							primary_zab integer,
							chronic_zab integer,
							repeated_zab integer,
							cnt_register integer,
							days_zab integer,
							cnt_zab integer,
							PRIMARY KEY(id_period, id_age_group, id_mkb, pol_patient)
);

--6

